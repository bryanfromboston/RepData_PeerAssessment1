# Reproducible Research
*Peer Assessment 1*

## Loading and preprocessing the data

### Downloading and loading the data
The data for this file is zipped and [stored here](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip).

```{r}
if (!file.exists("./data")){dir.create("./data")}
zippedURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
download.file(zippedURL, destfile="./data/activity.zip",method="curl")
csvFile <- unzip("./data/activity.zip", exdir = "./data")
activityData <- read.csv(csvFile)
```

### Cleaning up the data
The data is in a relatively clean state, but let's do some things to make it easier to work with:

1. Change the date format to a `Date` type
2. Make the `interval` column a factor

```{r}
activityData$date <- as.Date(activityData$date, format="%Y-%m-%d")
```

## What is the mean total number of steps taken per day?

### Histogram of total steps per day
We're going to use ggplot2 for plotting:
```{r stepsperday}
library(ggplot2)
c <- ggplot(activityData, aes(x=date, y=steps))
c + geom_bar(stat="identity")
```

### Mean and median of steps per day

The mean and median total number of steps per day (omiitting NAs):

```{r}
totals <- tapply(activityData$steps, activityData$date, FUN = sum, na.rm = TRUE)
mean(totals)
median(totals)
```

## What is the average daily activity pattern?

```{r intervalsummary}
library(plyr)
intervalSummary <- ddply(activityData, ~interval, summarise, avgsteps=mean(steps, na.rm=TRUE))
plot(intervalSummary$interval, intervalSummary$avgsteps, type="l")
maxInterval <- intervalSummary[which.max(intervalSummary$avgsteps),"interval"]
```

The 5-minute interval, on average across all days in the dataset, that contains the number of steps is **`r maxInterval`**.

### Imputing missing values

```{r}
nMissingRows <- nrow(activityData[complete.cases(activityData),])
```
The number of rows with missing data is **`r nMissingRows`**.

To impute the NA values in our dataset, we're going to take the mean value of the 5-minute interval of that day. We'll use `intervalSummary` as a lookup table.
```{r imputeddata}
newData <- activityData
for (i in 1:nrow(newData)) {
  if (is.na(newData$steps[i])) {
    newData$steps[i] <- intervalSummary[which(newData$interval[i] == intervalSummary$interval), ]$avgsteps
  }
}

c <- ggplot(newData, aes(x=date, y=steps))
c + geom_bar(stat="identity")

```

```{r}
totals.imputed <- tapply(newData$steps, newData$date, FUN = sum)
mean(totals.imputed)
median(totals.imputed)
```

### Are there differences in activity patterns between weekdays and weekends?
```{r}
newData$weekdays <- factor(weekdays(newData$date))
levels(newData$weekdays)
levels(newData$weekdays) <- list(WeekDay = c("Monday", "Tuesday",
                                             "Wednesday", 
                                             "Thursday", "Friday"),
                                 Weekend = c("Saturday", "Sunday"))
levels(newData$weekdays)
```

Plotting the Weekday/Weekend data (using Lattice this time)

```{r paneldays}
library(lattice)
newSummary <- aggregate(newData$steps, 
                      list(interval = as.numeric(as.character(newData$interval)), 
                           weekdays = newData$weekdays),
                      FUN = "mean")

names(newSummary)[3] <- "avgsteps"

plot <- xyplot(newSummary$avgsteps ~ newSummary$interval | newSummary$weekdays, 
       layout = c(1, 2), type = "l", 
       xlab = "Intervals", ylab = "Average Steps")
print(plot)
```